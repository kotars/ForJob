# Отче наш, иже еси на АйБиЭм ПиСи, код наш насущный дай нам!
# Помилуй нас от пэйпер джэма и фатал эрора! 
# Дай нам MD-ков неубываемых и паролей на них.
# Искупи нам десницей Своей комплектующих для Апгрейда ненасытного, ибо душит нас Жаба великая
# и страдаем мы от недостатка ресурсов системных. 
# Не допусти выполнения недопустимой операции и скрой сведения от очей наших.
# Не дай нам впасть во искушение новыми релизами, ибо лукав Нуралиев-искуситель сотоварищи. 
# Удержи нас грешных от эф-диска и формата. Да минуют нас бэд-блоки и вирусы. 
# Умерь гордыню нашу, ибо не зашарим и крохи малой ближнему своему.
# Избавь нас от Юзера глупого, ибо продвинут он стал и имя ему БУХ. 
# Выправи программы наши кривые, ибо клинит башни нам от конфигураторов и отладчиков Открой нам знание, ибо истинно говоришь Ты нам, где тру и фолс. 
# Откомментируй код наш многомегабайтный, ибо погрязли мы в MD-шниках своих

# Укроти ламеров, имя Твое всуе поминающих, ибо не ведают, что творят. Упаси нас от Галактик и Бэстов. Да приидет царствие одинэса. 
# Не заставь нас нырять в мануалы бездонные и хэлпы путанные, ибо ересь в них, а дай нам уразуметь ридмя крошечные,
# ибо в них слово Господне.

# Инкапсулируй объекты наши, ибо полиморфны они и наследуют Царствие Твое. Выведи нас из цикла бесконечного, 
# ибо на переход Твой безусловный уповаем. Укажи нам путь верный, ибо блуждаем мы средь интерфейсов и парадигм и несть им числа.
# Не пронеси мимо чашу сию неупиваемую, ибо пива
# жаждем мы и коннекта алкаем.

# Молим Тебя и ниц перед Тобой падаем со серверами нашими. Отныне и присно, энд лайфтайм, бэкап!


# ██████╗  ██████╗ ███████╗███████╗██╗   ██╗██████╗ ███████╗██████╗ 
# ██╔══██╗██╔═══██╗██╔════╝██╔════╝╚██╗ ██╔╝██╔══██╗██╔════╝██╔══██╗
# ██████╔╝██║   ██║███████╗█████╗   ╚████╔╝ ██████╔╝█████╗  ██████╔╝
# ██╔══██╗██║   ██║╚════██║██╔══╝    ╚██╔╝  ██╔═══╝ ██╔══╝  ██╔═══╝ 
# ██║  ██║╚██████╔╝███████║███████╗   ██║   ██║     ███████╗██║     
# ╚═╝  ╚═╝ ╚═════╝ ╚══════╝╚══════╝   ╚═╝   ╚═╝     ╚══════╝╚═╝     


CC=gcc
CFLAGS = -Wall -Wextra -Werror -std=c11 -g
GCOV_FLAGS=-fprofile-arcs -ftest-coverage

ifeq ($(shell uname), Linux)
    LDFLAGS = -lm -lncurses -lcheck -lsubunit -lm -lrt -lpthread
endif
ifeq ($(shell uname), Darwin)
    LDFLAGS = -lm -lncurses
endif

all: install

install:
	$(CC) $(CFLAGS) brick_game/tetris/*.c gui/cli/*.c control/control.c -o tetris $(LDFLAGS) -o build/tetris

uninstall:
	rm -rf build/tetris

gcov_report: lib_tetris.a
	$(CC) $(CFLAGS) $(GCOV_FLAGS) test/*.c brick_game/tetris/tetris.c -L. lib_tetris.a -o testing $(LDFLAGS)
	make run_tests
	lcov -t "testing" -o testing.info -c -d .
	genhtml -o report testing.info

lib_tetris.a:
	$(CC) $(CFLAGS) -c brick_game/tetris/tetris.c $(LDFLAGS) 
	ar rc lib_tetris.a *.o
	rm -rf *.o

test:	lib_tetris.a
	$(CC) $(CFLAGS) test/*.c -L. lib_tetris.a  $(LDFLAGS) -o testing 
	make run_tests
	
tetris: 
	$(CC) $(CFLAGS) brick_game/tetris/*.c gui/cli/*.c control/control.c -o tetris $(LDFLAGS)
	./tetris

format:
	clang-format -style=google -i */*/*.c */*.c

style:
	clang-format -style=google -n */*/*.c */*.c 
    
clean:
	rm -rf *.o *.info *.gcda *.gcno lib_tetris.a tetris testing report

run_tests:
	./testing

dvi:
	open opisanie.txt

dist:
	mkdir -p res
	cp -a brick_game res
	cp -a gui res
	cp -a opisanie.txt res
	tar -czf Tetris.tar.gz res
	rm -rf res	
# /**
#  *                             _ooOoo_
#  *                            o8888888o
#  *                            88" . "88
#  *                            (| -_- |)
#  *                            O\  =  /O
#  *                         ____/`---'\____
#  *                       .'  \\|     |//  `.
#  *                      /  \\|||  :  |||//  \
#  *                     /  _||||| -:- |||||-  \
#  *                     |   | \\\  -  /// |   |
#  *                     | \_|  ''\---/''  |   |
#  *                     \  .-\__  `-`  ___/-. /
#  *                   ___`. .'  /--.--\  `. . __
#  *                ."" '<  `.___\_<|>_/___.'  >'"".
#  *               | | :  `- \`.;`\ _ /`;.`/ - ` : | |
#  *               \  \ `-.   \_ __\ /__ _/   .-` /  /
#  *          ======`-.____`-.___\_____/___.-`____.-'======
#  *                             `=---='
#  *          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
#  *                     佛祖保佑        永无BUG
#  *            佛曰:
#  *                   写字楼里写字间，写字间里程序员；
#  *                   程序人员写程序，又拿程序换酒钱。
#  *                   酒醒只在网上坐，酒醉还来网下眠；
#  *                   酒醉酒醒日复日，网上网下年复年。
#  *                   但愿老死电脑间，不愿鞠躬老板前；
#  *                   奔驰宝马贵者趣，公交自行程序员。
#  *                   别人笑我忒疯癫，我笑自己命太贱；
#  *                   不见满街漂亮妹，哪个归得程序员？
#  */

